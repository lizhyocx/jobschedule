<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lizhy.auto.dao.ScheduleMonitorDAO">
  <resultMap id="BaseResultMap" type="com.lizhy.auto.model.ScheduleMonitorDO">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on 2017-10-18 15:11:51.
    -->
    <id column="job_id" jdbcType="BIGINT" property="jobId" />
    <result column="job_name" jdbcType="VARCHAR" property="jobName" />
    <result column="exe_interface" jdbcType="VARCHAR" property="exeInterface" />
    <result column="exe_url" jdbcType="VARCHAR" property="exeUrl" />
    <result column="notify_start" jdbcType="BIGINT" property="notifyStart" />
    <result column="notify_end" jdbcType="BIGINT" property="notifyEnd" />
    <result column="notify_status" jdbcType="INTEGER" property="notifyStatus" />
    <result column="return_status" jdbcType="INTEGER" property="returnStatus" />
    <result column="ret_msg" jdbcType="VARCHAR" property="retMsg" />
    <result column="prev_fire_time" jdbcType="BIGINT" property="prevFireTime" />
    <result column="next_fire_time" jdbcType="BIGINT" property="nextFireTime" />
    <result column="last_log_id" jdbcType="BIGINT" property="lastLogId" />
  </resultMap>

  <select id="selectScheduleList" parameterType="map" resultMap="BaseResultMap">
    SELECT
        a.job_id,
        a.job_name,
        b.exe_interface,
        b.exe_url,
        b.notify_start,
        b.notify_end,
        b.notify_status,
        b.return_status,
        b.ret_msg,
        c.PREV_FIRE_TIME,
        c.NEXT_FIRE_TIME,
        max(b.log_id) AS last_log_id
    FROM
        schedule_job a
        LEFT JOIN schedule_job_log b ON a.job_id = b.job_id
        LEFT JOIN schedule_qrtz_triggers c ON a.job_name = c.job_name
        where a.`status` = 1
          <if test="jobId != null">
              AND a.job_id = #{jobId}
          </if>
          <if test="jobName != null">
              AND a.job_name LIKE concat('%', #{jobName}, '%')
          </if>
        GROUP BY a.job_id
        limit #{offset}, #{pageSize}
  </select>

</mapper>